
{% extends 'website/base.html' %}
{% load i18n %}
{% load staticfiles %}


{% block styles %}
{% endblock %}


{% block content %}
    <!-- Intro Header -->
    <header class="intro" >
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 col-md-offset-0">
                    
                    	<P>
                    		<BR>
                    			<BR>
                    				
                    				<h3>{% trans "Summarize long comment threads" %}</h3>
                    				
                    				{% if user.is_authenticated %}
                    					<a class="btn btn-default btn-lg" data-toggle="modal" data-target="#createWikumModal">+ {% trans "Import Discussion" %}</a>
                    				{% else %}
			                    		<a href="/account/login" class="btn btn-default btn-lg">{% trans "Login" %}</a> 
			                    		<a href="/account/signup" class="btn btn-default btn-lg">{% trans "Sign Up" %}</a> 
			                    		<a class="btn btn-default btn-lg" data-toggle="modal" data-target="#createWikumModal">+ {% trans "Import Discussion" %}</a>
			                    	
			                    	{% endif %}

                    		<BR>
                    		<BR>
                    		<div>
                    		
                    		
                    		<ul id="post-list-table">
                    			<li class="first-row-item">
                    				<div class="first-blurb">
							  					<span class="percent">
								  					
								  						{% if sort == "-percent_complete" %}
								  							<strong>
								  								<a href="\?sort=percent_complete">% {% trans "Done" %}</a>
								  							</strong>
								  						{% elif sort == "percent_complete" %}
								  							<strong>
								  								<a href="\?sort=-percent_complete">% {% trans "Done" %}</a>
								  							</strong>
								  						{% else %}
								  							<a href="\?sort=-percent_complete">% {% trans "Done" %}</a>
								  						{% endif %}
								  					
								  				</span>
								  				<span class="source">
								  					{% if sort == "source" %}
								  						<strong>
								  							<a href="\?sort=-source">  {% trans "Source" %} </a>
								  						</strong>
								  					{% elif sort == "-source" %}
								  						<strong>
								  							<a href="\?sort=source"> {% trans "Source" %}  </a>
								  						</strong>
								  					{% else %}
								  						<a href="\?sort=source">{% trans "Source" %} </a>
								  					{% endif %}
								  				</span>
								  				<span class="owner">
								  					{% if sort == "owner" %}
								  						<strong>
								  							<a href="\?sort=-owner">Owner</a>
								  						</strong>
								  					{% elif sort == "-owner" %}
								  						<strong>
								  							<a href="\?sort=owner">Owner</a>
								  						</strong>
								  					{% else %}
								  						<a href="\?sort=owner">Owner</a>
								  					{% endif %}
								  				</span>
												<span class="ellipsis">
													{% if sort == "title" %}
														<strong>
													 		<a href="\?sort=-title">{% trans "Discussion" %}</a>
													 	</strong>
													{% elif sort == "-title" %}
														<strong> 
															<a href="\?sort=title">{% trans "Discussion" %}</a>
														</strong>
													{% else %}
													 	<a href="\?sort=title">{% trans "Discussion" %}</a>
													{% endif %}
												</span>
												<span class="right-side">
													<span class="comment_num" style="position: relative; left: -30px">
														{% if sort == "-comment_num" %}
															<strong>
								  								<a href="\?sort=comment_num">{% trans "Comments" %}</a>
								  							</strong>
								  						{% elif sort == "comment_num" %}
								  							<strong>
								  								<a href="\?sort=-comment_num">{% trans "Comments" %}</a>
								  							</strong>
								  						{% else %}
								  							<a href="\?sort=-comment_num">{% trans "Comments" %}</a>
								  						{% endif %}
								  					</span>
								  					<span class="summary_num">
								  						{% if sort == "-summary_num" %}
								  							<strong>
								  								<a href="\?sort=summary_num">{% trans "Summaries" %}</a>
								  							</strong>
								  						{% elif sort == "summary_num" %}
								  							<strong>
								  								<a href="\?sort=summary_num">{% trans "Summaries" %}</a>
								  							</strong>
								  						{% else %}
								  							<a href="\?sort=-summary_num">{% trans "Summaries" %}</a>
								  						{% endif %}
								  					</span>
								  				</span>
											</div>
										</li>
								
                    				
							  	{% for a in articles %}
							  	<a href="/visualization?article={{ a.url }}&num={{ a.num }}&owner={{ a.owner }}">								
							  		<li class="row-item">
							  			<progress value="{{ a.percent_complete }}" max="100"></progress>
							  			
							  				<div class="blurb">
							  					
							  					<span class="percent">
							  						
							  						{% if sort == "percent_complete" or sort == "-percent_complete" %}
									  					<strong>
									  						{{ a.percent_complete }}%
									  					</strong>
									  				{% else %}
									  						{{ a.percent_complete }}%
									  				{% endif %}
								  				</span>
								  				<span class="source">
								  					{% if sort == "source" or sort == "-source" %}
								  						<strong>
								  							{{a.source.source_name}}
								  						</strong>
								  					{% else %}
								  						{{a.source.source_name}}
								  					{% endif %}
								  				</span>
								  				<span class="owner">
								  					{% if sort == "owner" or sort == "-owner" %}
								  						<strong>
								  							{% if a.owner == user %}
								  								me
								  							{% else %}
								  								{{a.owner}}
								  							{% endif %}
								  						</strong>
								  					{% else %}
								  						{% if a.owner == user %}
								  								me
								  							{% else %}
								  								{{a.owner}}
								  							{% endif %}
								  					{% endif %}
								  				</span>
												<span class="ellipsis">
													{{ a.title }}
												</span>
												<span class="right-side">
													<span class="comment_num">
														{% if sort == "comment_num" or sort == "-comment_num" %}
															<strong>
								  								{{ a.comment_num }}
								  							</strong>
								  						{% else %}
								  							{{ a.comment_num }}
								  						{% endif %}
								  					</span>
								  					<span class="summary_num">
								  						{% if sort == "summary_num" or sort == "-summary_num" %}
															<strong>
								  								{{ a.summary_num }}
								  							</strong>
								  						{% else %}
								  							{{ a.summary_num }}
								  						{% endif %}
								  					</span>
								  				</span>
												
												
											</div>
				
										</li>
									</a>
								{% endfor %}
							 
							 	</ul>
							 </div>
               
						</p>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <!-- About Section -->
    <section id="about" class="container content-section text-center">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h2>{% trans "About Wikum" %}</h2>
                <p> {% trans "Wikum is a tool for summarizing and exploring long comment threads." %} 
                </p>
				<h4>
					{% trans "Wikum: Bridging Discussion Forums and Wikis using Recursive Summarization" %} 
				</h4>
				<P>
					{% trans "Large-scale discussions between many participants abound on the internet today, on topics ranging from political arguments to group coordination." %} 
					{% trans "But as these discussions grow to tens of thousands of posts, they become ever more difficult for a reader to digest.In this article, we describe a workflow called" %} 
					<i> {% trans "recursive summarization" %}</i>
					{% trans ", implemented in our " %} <i> Wikum </i> 
					{% trans "prototype, that enables a large population of readers or editors to work in small doses to refine out the main points of the discussion. More than just a single summary, our workflow produces a" %} 
					<i> {% trans  "summary tree" %}</i> {% trans "that enables a reader to explore distinct subtopics at multiple levels of detail based on their interests." %}
				</P>
				<br>
					{% trans "Wikum: Bridging Discussion Forums and Wikis using Recursive Summarization. Amy X. Zhang, Lea Verou, David Karger." %}
				<i>CSCW '17</i>. 
				<br>
				[<a href="http://people.csail.mit.edu/axz/papers/wikum.pdf">pdf</a>][<a href="http://people.csail.mit.edu/axz/wikum">{% trans "slides and talk" %}</a>]
            </div>
        </div>
    </section>
    <!-- Contact Section -->
    <section id="contact" class="container content-section text-center">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h2>{% trans "Contact Us" %}</h2>
                
       
					<a href="http://people.csail.mit.edu/axz">
					<img src="/static/website/img/amy.jpg" class="img-circle" width="150">
					</a>
					<br>
						<a href="https://twitter.com/amyxzh"><img src="/static/website/img/twitter.png" width="35">@amyxzh</a>
					<br>
						<a href="mailto:axz@mit.edu">
							axz@mit.edu
						</a>
					
			<BR><BR>
					<a href="http://people.csail.mit.edu/karger">
					<img src="/static/website/img/karger.png" class="img-circle" width="150">
					</a>
					<br>
						<a href="https://twitter.com/karger"><img src="/static/website/img/twitter.png" width="35">@karger</a>
					<br>
						<a href="mailto:karger@mit.edu">
							karger@mit.edu
						</a>
					
			<BR><BR>
                
                
                <ul class="list-inline banner-social-buttons">
                    <!--<li>
                        <a href="https://twitter.com/SBootstrap" class="btn btn-default btn-lg"><i class="fa fa-twitter fa-fw"></i> <span class="network-name">Twitter</span></a>
                    </li>
                                       <li>
                        <a href="https://plus.google.com/+Startbootstrap/posts" class="btn btn-default btn-lg"><i class="fa fa-google-plus fa-fw"></i> <span class="network-name">Google+</span></a>
                    </li>
                   -->
                    <li>
                        <a href="https://github.com/amyxzhang/wikum" class="btn btn-default btn-lg"><i class="fa fa-github fa-fw"></i> <span class="network-name">Github</span></a>
                    </li>

                </ul>
            </div>
        </div>
    </section>
    
    
<!-- Modal -->
<div id="createWikumModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{% trans "Import a Discussion" %}</h4>
      </div>
      <div class="modal-body">
      	
			{% trans "Import a new discussion by pasting an Atlantic article url, Reddit page url, or Wikipedia Talk page section url here." %}
        
		   <form>
		  <div class="form-group">
		  	
		    <input type="url" class="form-control" id="articleUrl" placeholder="">
		 	<BR>
		 	<button type="button" class="btn btn-default" id="submiturl">{% trans "Submit" %}</button>
		 
		  </div>
		  </form>
		  
	  	<div id="message" style="display: block; height:40px;">
	  	</div>
 
            
          <div class="progress_container" style="display: block; height: 70px;">
	   		<div class="status" style="display: block; height: 30px;">
	   			
	   		</div>
	   		
	   		<div class="result" style="display: block; height: 30px;">
	   		</div>
	  	</div>
        
        
      </div>
    </div>

  </div>
</div>

{% endblock %}


{% block scripts %}

<script>
	var PollState = function(task_id) {
		$.ajax({
 			url: "poll_status",
 			type: "POST",
 			data: "task_id=" + task_id,
		}).done(function(task){
 			console.log(task);
 			if (task.state == 'PROGRESS') {
 				if (task.result) {
  					$('.result').html('Status: ' + task.result.count + ' comments ingested.');
	  			} else{
	  				$('.result').html('Status: In progress...');
	  			}
  				setTimeout(PollState(task_id), 3000);
 			} else if (task.state == 'PENDING') {
 				$('.result').html('Status: Pending...');
 				setTimeout(PollState(task_id), 3000);
 			} else {
 				$('#message').text('');
 				if (task.state == 'SUCCESS') {
 					var article = $('#articleUrl').val();
 					article = article.replace('#', '%23').replace('&', '%26');
 					var owner = $('#owner').text();
 					if (!owner) {
 						owner = "None";
 					}
  					$('.status').html(task.state + '!  <a href="/visualization?article=' + article + '&owner=' + owner + '"><button class="btn btn-default btn-sm">View comments</button></a>');
  				} else {
  					$('.status').html(task.state + ' - ' + task.result);
  				}
 			};
		});
	};
	</script>


    <script>
    
    	function submiturl() {
    		var article = $('#articleUrl').val();
    		var owner = $('#owner').text();
			if (!owner) {
				owner = "None";
			}
			$.ajax({
				url: "import_article",
				data: {
					'article': article,
					'owner': owner,
				},
				success: function(res){
					console.log(res);
					$('.status').text('');
					$('.result').text('');
					$('#message').text('Wikum is now importing all the comments in the discussion. This may take a while as we are rate-limited by APIs.' + 
					' You can wait or come back later to find the article on the main page.');
				   	PollState(res);
				}
			});
    	}
    
    	$('#submiturl').click(function(event) {
    		submiturl();
    		return false;
    	});
    
		$('#articleUrl').keydown(function(event){ 
		    var keyCode = (event.keyCode ? event.keyCode : event.which);   
		    if (keyCode == 13) {
		    	submiturl();
				return false;
		    }
		});
		
		
    </script>





{% endblock %}
